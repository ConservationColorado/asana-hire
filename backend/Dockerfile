FROM eclipse-temurin:17-jdk-alpine AS builder

WORKDIR /opt/app

COPY /.mvn .mvn
COPY /mvnw /pom.xml ./
RUN ./mvnw dependency:go-offline

COPY /src ./src
RUN ./mvnw clean install

FROM eclipse-temurin:17-jre-alpine

WORKDIR /opt/app
EXPOSE 8080

ENV ASANA_ACCESS_TOKEN=${ASANA_ACCESS_TOKEN}
ENV ASANA_APPLICATION_PORTFOLIO_GID=${ASANA_APPLICATION_PORTFOLIO_GID}
ENV ASANA_INTERVIEW_PORTFOLIO_GID=${ASANA_INTERVIEW_PORTFOLIO_GID}
ENV ASANA_WORKSPACE_GID=${ASANA_WORKSPACE_GID}
ENV DB_PASSWORD=${DB_PASSWORD}
ENV DB_URL=${DB_URL}
ENV DB_USERNAME=${DB_USERNAME}
ENV GOOGLE_CLIENT_ID=${GOOGLE_CLIENT_ID}
ENV GOOGLE_CLIENT_SECRET=${GOOGLE_CLIENT_SECRET}
ENV SERVER_BASE_URL=${SERVER_BASE_URL}
ENV CLIENT_BASE_URL=${CLIENT_BASE_URL}
ENV SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}

COPY --from=builder /opt/app/target/*.jar /opt/app/*.jar

ENTRYPOINT ["java", "-jar", "/opt/app/*.jar"]
